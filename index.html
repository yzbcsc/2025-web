<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4a6ea9">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>每日陪娃背单词</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
        }
        .container {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            max-width: 100%;
            overflow-x: hidden;
        }
        h1 {
            color: #4a6ea9;
            text-align: center;
            margin: 10px 0 20px;
            font-size: 1.5rem;
        }
        .word-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            color: #2c3e50;
            word-break: break-word;
            min-height: 2.5em;
        }
        .meaning {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 15px;
            color: #7f8c8d;
            min-height: 1.5em;
        }
        button {
            background-color: #4a6ea9;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            margin: 8px 0;
            transition: all 0.2s;
            -webkit-appearance: none;
            user-select: none;
        }
        button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        /* 其他样式保持不变... */
    </style>
</head>
<body>
    <div class="container">
        <!-- 界面HTML保持不变，与之前相同 -->
    </div>

    <script>
        // 扩展词库（简化示例）
        const extendedLibrary = [
            {word: "apple", meaning: "苹果", example: "I eat an apple.", exampleMeaning: "我吃苹果"},
            {word: "book", meaning: "书", example: "This is a book.", exampleMeaning: "这是一本书"},
            // 添加更多单词...
        ];

        // 移动端专用状态
        const state = {
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isWeChat: /MicroMessenger/i.test(navigator.userAgent),
            isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
            speechSupport: 'speechSynthesis' in window,
            recognitionSupport: ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window),
            permissionGranted: false
        };

        // 移动端初始化
        function initMobileApp() {
            // 1. 绑定触摸事件
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('touchend', handleTap, {passive: true});
            });

            // 2. 检测语音支持
            if(!state.speechSupport) {
                showAlert('您的设备不支持语音朗读功能');
                document.getElementById('speak-btn').style.display = 'none';
            }

            // 3. 初始化语音识别
            if(state.recognitionSupport && !state.isWeChat) {
                initSpeechRecognition();
            } else {
                document.getElementById('voice-input-btn').style.display = 'none';
            }

            // 4. 加载词库
            loadWordLibrary();
        }

        // 移动端专用词库加载
        function loadWordLibrary() {
            try {
                const saved = localStorage.getItem('wordLibrary');
                state.allWords = saved ? JSON.parse(saved) : extendedLibrary;
            } catch(e) {
                state.allWords = extendedLibrary;
                showAlert('本地词库加载失败，使用默认词库');
            }
        }

        // 移动端语音识别初始化
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            state.recognition = new SpeechRecognition();
            state.recognition.continuous = false;
            state.recognition.interimResults = false;
            state.recognition.lang = 'en-US';

            // 移动端特殊处理
            state.recognition.onstart = () => {
                document.getElementById('voice-input-status').textContent = '正在聆听...';
            };

            state.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('dictation-input').value = transcript;
                setTimeout(checkSpelling, 300);
            };

            // 错误处理
            state.recognition.onerror = (event) => {
                if(event.error === 'not-allowed') {
                    showAlert('请允许麦克风权限');
                }
            };
        }

        // 移动端专用点击处理
        function handleTap(e) {
            e.preventDefault();
            const btn = e.currentTarget;
            btn.click(); // 触发原生click
            
            // 添加点击反馈
            btn.style.transform = 'scale(0.98)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 100);
        }

        // 移动端显示提示
        function showAlert(msg) {
            const alertBox = document.createElement('div');
            alertBox.style.position = 'fixed';
            alertBox.style.bottom = '20px';
            alertBox.style.left = '50%';
            alertBox.style.transform = 'translateX(-50%)';
            alertBox.style.backgroundColor = 'rgba(0,0,0,0.7)';
            alertBox.style.color = 'white';
            alertBox.style.padding = '10px 20px';
            alertBox.style.borderRadius = '20px';
            alertBox.style.zIndex = '1000';
            alertBox.textContent = msg;
            
            document.body.appendChild(alertBox);
            setTimeout(() => {
                alertBox.remove();
            }, 2000);
        }

        // PWA安装提示
        function showInstallPrompt() {
            if(state.isMobile && !window.matchMedia('(display-mode: standalone)').matches) {
                const installBtn = document.createElement('button');
                installBtn.textContent = '添加到主屏幕';
                installBtn.style.position = 'fixed';
                installBtn.style.bottom = '10px';
                installBtn.style.right = '10px';
                installBtn.style.zIndex = '1000';
                installBtn.onclick = () => {
                    if(window.deferredPrompt) {
                        window.deferredPrompt.prompt();
                    }
                };
                document.body.appendChild(installBtn);
            }
        }

        // 监听安装事件
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredPrompt = e;
            showInstallPrompt();
        });

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            if(state.isMobile) {
                initMobileApp();
            } else {
                initDesktopApp();
            }
            
            // 禁用长按菜单
            document.addEventListener('contextmenu', (e) => {
                if(state.isMobile) e.preventDefault();
            });
        });
    </script>
</body>
</html>
